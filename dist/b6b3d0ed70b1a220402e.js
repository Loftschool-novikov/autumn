(window.webpackJsonp=window.webpackJsonp||[]).push([[12],{410:function(e,t,r){"use strict";r.d(t,"b",(function(){return n})),r.d(t,"a",(function(){return a}));var i=r(105),n=function(e){var t=new FileReader;return new Promise((function(r,i){try{t.readAsDataURL(e),t.onloadend=function(){r(t.result)}}catch(e){throw new Error("Ошибка при чтении файла")}}))},a=function(e){var t=i.a.defaults.baseURL;return"".concat(t,"/").concat(e)}},427:function(e,t,r){},452:function(e,t,r){"use strict";var i=r(427);r.n(i).a},471:function(e,t,r){"use strict";r.r(t);var i=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("adding-form",{attrs:{title:e.title,disabled:e.disableForm,buttonsPadding:"0 20% 0 0"},on:{submit:function(t){"add"===e.mode?e.addNewReview():e.editCurrentReview()},cancel:e.closeForm}},[r("div",{staticClass:"reviews__form-content",attrs:{slot:"form-content"},slot:"form-content"},[r("div",{staticClass:"reviews__form-userpic"},[r("label",{staticClass:"reviews__form-avatar-upload",class:{error:e.validation.hasError("review.photo")}},[r("input",{staticClass:"reviews__form-file-input",attrs:{type:"file"},on:{change:e.handlePhotoUpload}}),r("div",{staticClass:"reviews__form-pic"},[r("div",{staticClass:"reviews__form-avatar-empty",class:{filled:e.renderedAvatar.length},style:{backgroundImage:e.userAvatarUrl}})]),r("div",{staticClass:"reviews__form-addphoto"},[e._v("Добавить фото")]),r("div",{staticClass:"reviews__avatar-error"},[r("errors-tooltip",{attrs:{errorText:e.validation.firstError("review.photo")}})],1)])]),r("div",{staticClass:"reviews__form-col"},[r("div",{staticClass:"reviews__form-row"},[r("div",{staticClass:"reviews__form-block"},[r("app-input",{attrs:{title:"Имя автора",errorText:e.validation.firstError("review.author")},model:{value:e.review.author,callback:function(t){e.$set(e.review,"author",t)},expression:"review.author"}})],1),r("div",{staticClass:"reviews__form-block"},[r("app-input",{attrs:{title:"Титул автора",errorText:e.validation.firstError("review.occ")},model:{value:e.review.occ,callback:function(t){e.$set(e.review,"occ",t)},expression:"review.occ"}})],1)]),r("div",{staticClass:"reviews__form-row"},[r("div",{staticClass:"reviews__form-block"},[r("app-input",{attrs:{title:"Отзыв","field-type":"textarea",errorText:e.validation.firstError("review.text")},model:{value:e.review.text,callback:function(t){e.$set(e.review,"text",t)},expression:"review.text"}})],1)])])])])};i._withStripped=!0;var n=r(36),a=r(410),o=r(30);function s(e,t,r,i,n,a,o){try{var s=e[a](o),c=s.value}catch(e){return void r(e)}s.done?t(c):Promise.resolve(c).then(i,n)}function c(e){return function(){var t=this,r=arguments;return new Promise((function(i,n){var a=e.apply(t,r);function o(e){s(a,i,n,o,c,"next",e)}function c(e){s(a,i,n,o,c,"throw",e)}o(void 0)}))}}function u(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,i)}return r}function l(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?u(Object(r),!0).forEach((function(t){v(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):u(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function v(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var d={mixins:[r(30).mixin],validators:{"review.author":function(e){return o.Validator.value(e).required("Заполните автора")},"review.occ":function(e){return o.Validator.value(e).required("Укажите роль автора")},"review.text":function(e){return o.Validator.value(e).required("Введите текст отзыва")},"review.photo":function(e){return o.Validator.value(e).required("Вставьте аватар")}},components:{appInput:function(){return r.e(0).then(r.bind(null,461))},appButton:function(){return r.e(3).then(r.bind(null,480))},addingForm:function(){return r.e(6).then(r.bind(null,481))},errorsTooltip:function(){return r.e(4).then(r.bind(null,482))}},data:function(){return{renderedAvatar:"",disableForm:!1,review:{id:0,author:"",occ:"",text:"",photo:""}}},props:{title:{type:String,default:"Новый отзыв"},mode:{type:String,default:"add",validator:function(e){return["add","edit"].includes(e)}}},computed:l({},Object(n.e)("reviews",{currentReview:function(e){return e.currentReview}}),{userAvatarUrl:function(){return"url(".concat(this.renderedAvatar,")")}}),watch:{currentReview:function(e){"edit"===this.mode&&this.fillFormWithCurrentReviewData()}},created:function(){"edit"===this.mode&&this.fillFormWithCurrentReviewData()},methods:l({},Object(n.b)("reviews",["addReview","updateReview"]),{},Object(n.b)("tooltips",["showTooltip"]),{closeForm:function(){this.review={},this.$emit("cancel")},editCurrentReview:function(){var e=this;return c(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!1!==e.$validate()){t.next=2;break}return t.abrupt("return");case 2:return e.disableForm=!0,t.prev=3,t.next=6,e.updateReview(e.review);case 6:t.sent,e.$emit("cancel"),e.showTooltip({type:"success",text:"Работа обновлена"}),t.next=14;break;case 11:t.prev=11,t.t0=t.catch(3),e.showTooltip({type:"error",text:t.t0.message});case 14:return t.prev=14,e.disableForm=!1,e.validation.reset(),t.finish(14);case 18:case"end":return t.stop()}}),t,null,[[3,11,14,18]])})))()},addNewReview:function(){var e=this;return c(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.$validate();case 2:if(t.t0=t.sent,!1!==t.t0){t.next=5;break}return t.abrupt("return");case 5:return e.disableForm=!0,t.prev=6,t.next=9,e.addReview(e.review);case 9:t.sent,e.clearFormFields(),e.showTooltip({type:"success",text:"Отзыв добавлен"}),t.next=17;break;case 14:t.prev=14,t.t1=t.catch(6),e.showTooltip({type:"error",text:t.t1.message});case 17:return t.prev=17,e.disableForm=!1,e.valdation.reset(),t.finish(17);case 21:case"end":return t.stop()}}),t,null,[[6,14,17,21]])})))()},clearFormFields:function(){this.review={},this.renderedAvatar=""},fillFormWithCurrentReviewData:function(){this.review=l({},this.currentReview),this.renderedAvatar=Object(a.a)(this.currentReview.photo)},handlePhotoUpload:function(e){var t=this;return c(regeneratorRuntime.mark((function r(){var i,n;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return i=e.target.files[0],t.review.photo=i,r.prev=2,r.next=5,Object(a.b)(i);case 5:n=r.sent,t.renderedAvatar=n,r.next=12;break;case 9:r.prev=9,r.t0=r.catch(2),t.showTooltip({type:"error",text:"Ошибка во время обработки файла"});case 12:case"end":return r.stop()}}),r,null,[[2,9]])})))()}})},f=(r(452),r(104)),p=Object(f.a)(d,i,[],!1,null,"46b6a48f",null);p.options.__file="src/admin/components/reviews-add.vue";t.default=p.exports}}]);